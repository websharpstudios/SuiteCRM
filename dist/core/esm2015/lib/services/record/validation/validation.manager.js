/**
 * SuiteCRM is a customer relationship management program developed by SalesAgility Ltd.
 * Copyright (C) 2021 SalesAgility Ltd.
 *
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU Affero General Public License version 3 as published by the
 * Free Software Foundation with the addition of the following permission added
 * to Section 15 as permitted in Section 7(a): FOR ANY PART OF THE COVERED WORK
 * IN WHICH THE COPYRIGHT IS OWNED BY SALESAGILITY, SALESAGILITY DISCLAIMS THE
 * WARRANTY OF NON INFRINGEMENT OF THIRD PARTY RIGHTS.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more
 * details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * In accordance with Section 7(b) of the GNU Affero General Public License
 * version 3, these Appropriate Legal Notices must retain the display of the
 * "Supercharged by SuiteCRM" logo. If the display of the logos is not reasonably
 * feasible for technical reasons, the Appropriate Legal Notices must display
 * the words "Supercharged by SuiteCRM".
 */
import { Injectable } from '@angular/core';
import { OverridableMap } from 'common';
import { RequiredValidator } from './validators/required.validator';
import { CurrencyValidator } from './validators/currency.validator';
import { DateValidator } from './validators/date.validator';
import { DateTimeValidator } from './validators/datetime.validator';
import { FloatValidator } from './validators/float.validator';
import { IntValidator } from './validators/int.validator';
import { EmailValidator } from './validators/email.validator';
import { PhoneValidator } from './validators/phone.validator';
import { RangeValidator } from './validators/range.validator';
import { PrimaryEmailValidator } from './validators/primary-email.validator';
import { DuplicateEmailValidator } from './validators/duplicate-email.validator';
import * as i0 from "@angular/core";
import * as i1 from "./validators/required.validator";
import * as i2 from "./validators/range.validator";
import * as i3 from "./validators/currency.validator";
import * as i4 from "./validators/date.validator";
import * as i5 from "./validators/datetime.validator";
import * as i6 from "./validators/email.validator";
import * as i7 from "./validators/float.validator";
import * as i8 from "./validators/int.validator";
import * as i9 from "./validators/phone.validator";
import * as i10 from "./validators/primary-email.validator";
import * as i11 from "./validators/duplicate-email.validator";
export class ValidationManager {
    constructor(requiredValidator, rangeValidator, currencyValidator, dateValidator, datetimeValidator, emailValidator, floatValidator, intValidator, phoneValidator, primaryEmailValidator, duplicateEmailValidator) {
        this.requiredValidator = requiredValidator;
        this.rangeValidator = rangeValidator;
        this.currencyValidator = currencyValidator;
        this.dateValidator = dateValidator;
        this.datetimeValidator = datetimeValidator;
        this.emailValidator = emailValidator;
        this.floatValidator = floatValidator;
        this.intValidator = intValidator;
        this.phoneValidator = phoneValidator;
        this.primaryEmailValidator = primaryEmailValidator;
        this.duplicateEmailValidator = duplicateEmailValidator;
        this.filterFieldExclusion = {
            default: {}
        };
        this.saveFieldExclusions = {
            default: {}
        };
        this.saveValidators = new OverridableMap();
        this.asyncSaveValidators = new OverridableMap();
        this.filterValidators = new OverridableMap();
        this.saveValidators.addEntry('default', this.getKey('required', 'all'), requiredValidator);
        this.saveValidators.addEntry('default', this.getKey('range', 'all'), rangeValidator);
        this.saveValidators.addEntry('default', this.getKey('currency', 'all'), currencyValidator);
        this.saveValidators.addEntry('default', this.getKey('date', 'all'), dateValidator);
        this.saveValidators.addEntry('default', this.getKey('datetime', 'all'), datetimeValidator);
        this.saveValidators.addEntry('default', this.getKey('email', 'all'), emailValidator);
        this.saveValidators.addEntry('default', this.getKey('float', 'all'), floatValidator);
        this.saveValidators.addEntry('default', this.getKey('int', 'all'), intValidator);
        this.saveValidators.addEntry('default', this.getKey('phone', 'all'), phoneValidator);
        this.saveValidators.addEntry('default', this.getKey('primary-email', 'all'), primaryEmailValidator);
        this.saveValidators.addEntry('default', this.getKey('duplicate-email', 'all'), duplicateEmailValidator);
        this.filterValidators.addEntry('default', this.getKey('date', 'all'), dateValidator);
        this.filterValidators.addEntry('default', this.getKey('datetime', 'all'), datetimeValidator);
        this.filterValidators.addEntry('default', this.getKey('float', 'all'), floatValidator);
        this.filterValidators.addEntry('default', this.getKey('currency', 'all'), currencyValidator);
        this.filterValidators.addEntry('default', this.getKey('int', 'all'), intValidator);
        this.filterValidators.addEntry('default', this.getKey('phone', 'all'), phoneValidator);
    }
    registerFieldSaveValidator(module, type, field, validator) {
        this.saveValidators.addEntry(module, this.getKey(type, field), validator);
    }
    registerSaveValidator(module, type, validator) {
        this.saveValidators.addEntry(module, this.getKey(type, 'all'), validator);
    }
    registerFieldFilterValidator(module, type, field, validator) {
        this.filterValidators.addEntry(module, this.getKey(type, field), validator);
    }
    registerFilterValidator(module, type, validator) {
        this.filterValidators.addEntry(module, this.getKey(type, 'all'), validator);
    }
    excludeFieldSaveValidator(module, type, field) {
        const moduleExclusions = this.saveFieldExclusions[module] || {};
        const key = this.getKey(type, field);
        moduleExclusions[key] = key;
        this.saveFieldExclusions[module] = moduleExclusions;
    }
    excludeSaveValidator(module, type) {
        this.saveValidators.excludeEntry(module, this.getKey(type, 'all'));
    }
    excludeFieldFilterValidator(module, type, field) {
        const moduleExclusions = this.filterFieldExclusion[module] || {};
        const key = this.getKey(type, field);
        moduleExclusions[key] = key;
        this.filterFieldExclusion[module] = moduleExclusions;
    }
    excludeFilterValidator(module, type) {
        this.filterValidators.excludeEntry(module, this.getKey(type, 'all'));
    }
    registerAsyncSaveValidator(module, type, validator) {
        this.asyncSaveValidators.addEntry(module, this.getKey(type, 'all'), validator);
    }
    excludeAsyncSaveValidator(module, type) {
        this.saveValidators.excludeEntry(module, this.getKey(type, 'all'));
    }
    getSaveValidations(module, viewField, record) {
        const entries = this.saveValidators.getGroupEntries(module);
        const exclusions = this.getExclusions(module, this.saveFieldExclusions);
        return this.filterValidations(entries, exclusions, record, viewField);
    }
    getFilterValidations(module, viewField, record) {
        const entries = this.filterValidators.getGroupEntries(module);
        const exclusions = this.getExclusions(module, this.filterFieldExclusion);
        return this.filterValidations(entries, exclusions, record, viewField);
    }
    getAsyncSaveValidations(module, viewField, record) {
        const validations = [];
        const entries = this.asyncSaveValidators.getGroupEntries(module);
        Object.keys(entries).forEach(validatorKey => {
            const validator = entries[validatorKey];
            if (validator.applies(record, viewField)) {
                validations.push(validator.getValidator(viewField, record));
            }
        });
        return validations;
    }
    getKey(type, field) {
        return `${type}.${field}`;
    }
    parseType(key) {
        const partsType = key.split('.') || [];
        return partsType[0] || '';
    }
    getExclusions(module, exclusionMap) {
        const defaultExclusions = exclusionMap['default'] || {};
        const moduleExclusions = exclusionMap[module] || {};
        return Object.assign(Object.assign({}, defaultExclusions), moduleExclusions);
    }
    filterValidations(entries, fieldExclusions, record, viewField) {
        let validations = [];
        Object.keys(entries).forEach(validatorKey => {
            const defaultTypeKey = this.getKey(this.parseType(validatorKey), viewField.name);
            if (fieldExclusions[validatorKey] || fieldExclusions[defaultTypeKey]) {
                return;
            }
            const validator = entries[validatorKey];
            if (validator.applies(record, viewField)) {
                validations = validations.concat(validator.getValidator(viewField, record));
            }
        });
        return validations;
    }
}
ValidationManager.ɵprov = i0.ɵɵdefineInjectable({ factory: function ValidationManager_Factory() { return new ValidationManager(i0.ɵɵinject(i1.RequiredValidator), i0.ɵɵinject(i2.RangeValidator), i0.ɵɵinject(i3.CurrencyValidator), i0.ɵɵinject(i4.DateValidator), i0.ɵɵinject(i5.DateTimeValidator), i0.ɵɵinject(i6.EmailValidator), i0.ɵɵinject(i7.FloatValidator), i0.ɵɵinject(i8.IntValidator), i0.ɵɵinject(i9.PhoneValidator), i0.ɵɵinject(i10.PrimaryEmailValidator), i0.ɵɵinject(i11.DuplicateEmailValidator)); }, token: ValidationManager, providedIn: "root" });
ValidationManager.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
ValidationManager.ctorParameters = () => [
    { type: RequiredValidator },
    { type: RangeValidator },
    { type: CurrencyValidator },
    { type: DateValidator },
    { type: DateTimeValidator },
    { type: EmailValidator },
    { type: FloatValidator },
    { type: IntValidator },
    { type: PhoneValidator },
    { type: PrimaryEmailValidator },
    { type: DuplicateEmailValidator }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbi5tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vY29yZS9hcHAvY29yZS9zcmMvbGliL3NlcnZpY2VzL3JlY29yZC92YWxpZGF0aW9uL3ZhbGlkYXRpb24ubWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0JHO0FBRUgsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV6QyxPQUFPLEVBQVcsY0FBYyxFQUF1RCxNQUFNLFFBQVEsQ0FBQztBQUd0RyxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxpQ0FBaUMsQ0FBQztBQUNsRSxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxpQ0FBaUMsQ0FBQztBQUNsRSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFDbEUsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQzVELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSw0QkFBNEIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDNUQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQzVELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw4QkFBOEIsQ0FBQztBQUM1RCxPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSxzQ0FBc0MsQ0FBQztBQUMzRSxPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSx3Q0FBd0MsQ0FBQzs7Ozs7Ozs7Ozs7OztBQXlCL0UsTUFBTSxPQUFPLGlCQUFpQjtJQVcxQixZQUNjLGlCQUFvQyxFQUNwQyxjQUE4QixFQUM5QixpQkFBb0MsRUFDcEMsYUFBNEIsRUFDNUIsaUJBQW9DLEVBQ3BDLGNB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SixVQUFVLFNBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckI7OztZQWxDTyxpQkFBaUI7WUFRakIsY0FBYztZQVBkLGlCQUFpQjtZQUNqQixhQUFhO1lBQ2IsaUJBQWlCO1lBR2pCLGNBQWM7WUFGZCxjQUFjO1lBQ2QsWUFBWTtZQUVaLGNBQWM7WUFFZCxxQkFBcUI7WUFDckIsdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTdWl0ZUNSTSBpcyBhIGN1c3RvbWVyIHJlbGF0aW9uc2hpcCBtYW5hZ2VtZW50IHByb2dyYW0gZGV2ZWxvcGVkIGJ5IFNhbGVzQWdpbGl0eSBMdGQuXG4gKiBDb3B5cmlnaHQgKEMpIDIwMjEgU2FsZXNBZ2lsaXR5IEx0ZC5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdCB1bmRlclxuICogdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbiAzIGFzIHB1Ymxpc2hlZCBieSB0aGVcbiAqIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiB3aXRoIHRoZSBhZGRpdGlvbiBvZiB0aGUgZm9sbG93aW5nIHBlcm1pc3Npb24gYWRkZWRcbiAqIHRvIFNlY3Rpb24gMTUgYXMgcGVybWl0dGVkIGluIFNlY3Rpb24gNyhhKTogRk9SIEFOWSBQQVJUIE9GIFRIRSBDT1ZFUkVEIFdPUktcbiAqIElOIFdISUNIIFRIRSBDT1BZUklHSFQgSVMgT1dORUQgQlkgU0FMRVNBR0lMSVRZLCBTQUxFU0FHSUxJVFkgRElTQ0xBSU1TIFRIRVxuICogV0FSUkFOVFkgT0YgTk9OIElORlJJTkdFTUVOVCBPRiBUSElSRCBQQVJUWSBSSUdIVFMuXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUXG4gKiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTU1xuICogRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZVxuICogZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICpcbiAqIEluIGFjY29yZGFuY2Ugd2l0aCBTZWN0aW9uIDcoYikgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogdmVyc2lvbiAzLCB0aGVzZSBBcHByb3ByaWF0ZSBMZWdhbCBOb3RpY2VzIG11c3QgcmV0YWluIHRoZSBkaXNwbGF5IG9mIHRoZVxuICogXCJTdXBlcmNoYXJnZWQgYnkgU3VpdGVDUk1cIiBsb2dvLiBJZiB0aGUgZGlzcGxheSBvZiB0aGUgbG9nb3MgaXMgbm90IHJlYXNvbmFibHlcbiAqIGZlYXNpYmxlIGZvciB0ZWNobmljYWwgcmVhc29ucywgdGhlIEFwcHJvcHJpYXRlIExlZ2FsIE5vdGljZXMgbXVzdCBkaXNwbGF5XG4gKiB0aGUgd29yZHMgXCJTdXBlcmNoYXJnZWQgYnkgU3VpdGVDUk1cIi5cbiAqL1xuXG5pbXBvcnQge0luamVjdGFibGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtWYWxpZGF0b3JJbnRlcmZhY2V9IGZyb20gJy4vdmFsaWRhdG9yLkludGVyZmFjZSc7XG5pbXBvcnQge01hcEVudHJ5LCBPdmVycmlkYWJsZU1hcCwgUmVjb3JkLCBTdHJpbmdNYXAsIFN0cmluZ01hdHJpeCwgVmlld0ZpZWxkRGVmaW5pdGlvbn0gZnJvbSAnY29tbW9uJztcbmltcG9ydCB7QXN5bmNWYWxpZGF0b3JGbiwgVmFsaWRhdG9yRm59IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7QXN5bmNWYWxpZGF0b3JJbnRlcmZhY2V9IGZyb20gJy4vYXluYy12YWxpZGF0b3IuSW50ZXJmYWNlJztcbmltcG9ydCB7UmVxdWlyZWRWYWxpZGF0b3J9IGZyb20gJy4vdmFsaWRhdG9ycy9yZXF1aXJlZC52YWxpZGF0b3InO1xuaW1wb3J0IHtDdXJyZW5jeVZhbGlkYXRvcn0gZnJvbSAnLi92YWxpZGF0b3JzL2N1cnJlbmN5LnZhbGlkYXRvcic7XG5pbXBvcnQge0RhdGVWYWxpZGF0b3J9IGZyb20gJy4vdmFsaWRhdG9ycy9kYXRlLnZhbGlkYXRvcic7XG5pbXBvcnQge0RhdGVUaW1lVmFsaWRhdG9yfSBmcm9tICcuL3ZhbGlkYXRvcnMvZGF0ZXRpbWUudmFsaWRhdG9yJztcbmltcG9ydCB7RmxvYXRWYWxpZGF0b3J9IGZyb20gJy4vdmFsaWRhdG9ycy9mbG9hdC52YWxpZGF0b3InO1xuaW1wb3J0IHtJbnRWYWxpZGF0b3J9IGZyb20gJy4vdmFsaWRhdG9ycy9pbnQudmFsaWRhdG9yJztcbmltcG9ydCB7RW1haWxWYWxpZGF0b3J9IGZyb20gJy4vdmFsaWRhdG9ycy9lbWFpbC52YWxpZGF0b3InO1xuaW1wb3J0IHtQaG9uZVZhbGlkYXRvcn0gZnJvbSAnLi92YWxpZGF0b3JzL3Bob25lLnZhbGlkYXRvcic7XG5pbXBvcnQge1JhbmdlVmFsaWRhdG9yfSBmcm9tICcuL3ZhbGlkYXRvcnMvcmFuZ2UudmFsaWRhdG9yJztcbmltcG9ydCB7UHJpbWFyeUVtYWlsVmFsaWRhdG9yfSBmcm9tICcuL3ZhbGlkYXRvcnMvcHJpbWFyeS1lbWFpbC52YWxpZGF0b3InO1xuaW1wb3J0IHtEdXBsaWNhdGVFbWFpbFZhbGlkYXRvcn0gZnJvbSAnLi92YWxpZGF0b3JzL2R1cGxpY2F0ZS1lbWFpbC52YWxpZGF0b3InO1xuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRpb25NYW5hZ2VySW50ZXJmYWNlIHtcbiAgICByZWdpc3RlclNhdmVWYWxpZGF0b3IobW9kdWxlOiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWxpZGF0b3I6IFZhbGlkYXRvckludGVyZmFjZSk6IHZvaWQ7XG5cbiAgICByZWdpc3RlckZpbHRlclZhbGlkYXRvcihtb2R1bGU6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbGlkYXRvcjogVmFsaWRhdG9ySW50ZXJmYWNlKTogdm9pZDtcblxuICAgIGV4Y2x1ZGVTYXZlVmFsaWRhdG9yKG1vZHVsZTogc3RyaW5nLCBrZXk6IHN0cmluZyk6IHZvaWQ7XG5cbiAgICBleGNsdWRlRmlsdGVyVmFsaWRhdG9yKG1vZHVsZTogc3RyaW5nLCBrZXk6IHN0cmluZyk6IHZvaWQ7XG5cbiAgICByZWdpc3RlckFzeW5jU2F2ZVZhbGlkYXRvcihtb2R1bGU6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbGlkYXRvcjogQXN5bmNWYWxpZGF0b3JJbnRlcmZhY2UpOiB2b2lkO1xuXG4gICAgZXhjbHVkZUFzeW5jU2F2ZVZhbGlkYXRvcihtb2R1bGU6IHN0cmluZywga2V5OiBzdHJpbmcpOiB2b2lkO1xuXG4gICAgZ2V0U2F2ZVZhbGlkYXRpb25zKG1vZHVsZTogc3RyaW5nLCB2aWV3RmllbGQ6IFZpZXdGaWVsZERlZmluaXRpb24sIHJlY29yZDogUmVjb3JkKTogVmFsaWRhdG9yRm5bXTtcblxuICAgIGdldEZpbHRlclZhbGlkYXRpb25zKG1vZHVsZTogc3RyaW5nLCB2aWV3RmllbGQ6IFZpZXdGaWVsZERlZmluaXRpb24sIHJlY29yZDogUmVjb3JkKTogVmFsaWRhdG9yRm5bXTtcblxuICAgIGdldEFzeW5jU2F2ZVZhbGlkYXRpb25zKG1vZHVsZTogc3RyaW5nLCB2aWV3RmllbGQ6IFZpZXdGaWVsZERlZmluaXRpb24sIHJlY29yZDogUmVjb3JkKTogQXN5bmNWYWxpZGF0b3JGbltdO1xufVxuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25NYW5hZ2VyIGltcGxlbWVudHMgVmFsaWRhdGlvbk1hbmFnZXJJbnRlcmZhY2Uge1xuICAgIHByb3RlY3RlZCBzYXZlVmFsaWRhdG9yczogT3ZlcnJpZGFibGVNYXA8VmFsaWRhdG9ySW50ZXJmYWNlPjtcbiAgICBwcm90ZWN0ZWQgYXN5bmNTYXZlVmFsaWRhdG9yczogT3ZlcnJpZGFibGVNYXA8QXN5bmNWYWxpZGF0b3JJbnRlcmZhY2U+O1xuICAgIHByb3RlY3RlZCBmaWx0ZXJWYWxpZGF0b3JzOiBPdmVycmlkYWJsZU1hcDxWYWxpZGF0b3JJbnRlcmZhY2U+O1xuICAgIHByb3RlY3RlZCBmaWx0ZXJGaWVsZEV4Y2x1c2lvbjogU3RyaW5nTWF0cml4ID0ge1xuICAgICAgICBkZWZhdWx0OiB7fVxuICAgIH07XG4gICAgcHJvdGVjdGVkIHNhdmVGaWVsZEV4Y2x1c2lvbnM6IFN0cmluZ01hdHJpeCA9IHtcbiAgICAgICAgZGVmYXVsdDoge31cbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByb3RlY3RlZCByZXF1aXJlZFZhbGlkYXRvcjogUmVxdWlyZWRWYWxpZGF0b3IsXG4gICAgICAgIHByb3RlY3RlZCByYW5nZVZhbGlkYXRvcjogUmFuZ2VWYWxpZGF0b3IsXG4gICAgICAgIHByb3RlY3RlZCBjdXJyZW5jeVZhbGlkYXRvcjogQ3VycmVuY3lWYWxpZGF0b3IsXG4gICAgICAgIHByb3RlY3RlZCBkYXRlVmFsaWRhdG9yOiBEYXRlVmFsaWRhdG9yLFxuICAgICAgICBwcm90ZWN0ZWQgZGF0ZXRpbWVWYWxpZGF0b3I6IERhdGVUaW1lVmFsaWRhdG9yLFxuICAgICAgICBwcm90ZWN0ZWQgZW1haWxWYWxpZGF0b3I6IEVtYWlsVmFsaWRhdG9yLFxuICAgICAgICBwcm90ZWN0ZWQgZmxvYXRWYWxpZGF0b3I6IEZsb2F0VmFsaWRhdG9yLFxuICAgICAgICBwcm90ZWN0ZWQgaW50VmFsaWRhdG9yOiBJbnRWYWxpZGF0b3IsXG4gICAgICAgIHByb3RlY3RlZCBwaG9uZVZhbGlkYXRvcjogUGhvbmVWYWxpZGF0b3IsXG4gICAgICAgIHByb3RlY3RlZCBwcmltYXJ5RW1haWxWYWxpZGF0b3I6IFByaW1hcnlFbWFpbFZhbGlkYXRvcixcbiAgICAgICAgcHJvdGVjdGVkIGR1cGxpY2F0ZUVtYWlsVmFsaWRhdG9yOiBEdXBsaWNhdGVFbWFpbFZhbGlkYXRvclxuICAgICkge1xuXG4gICAgICAgIHRoaXMuc2F2ZVZhbGlkYXRvcnMgPSBuZXcgT3ZlcnJpZGFibGVNYXA8VmFsaWRhdG9ySW50ZXJmYWNlPigpO1xuICAgICAgICB0aGlzLmFzeW5jU2F2ZVZhbGlkYXRvcnMgPSBuZXcgT3ZlcnJpZGFibGVNYXA8QXN5bmNWYWxpZGF0b3JJbnRlcmZhY2U+KCk7XG4gICAgICAgIHRoaXMuZmlsdGVyVmFsaWRhdG9ycyA9IG5ldyBPdmVycmlkYWJsZU1hcDxWYWxpZGF0b3JJbnRlcmZhY2U+KCk7XG5cbiAgICAgICAgdGhpcy5zYXZlVmFsaWRhdG9ycy5hZGRFbnRyeSgnZGVmYXVsdCcsIHRoaXMuZ2V0S2V5KCdyZXF1aXJlZCcsICdhbGwnKSwgcmVxdWlyZWRWYWxpZGF0b3IpO1xuICAgICAgICB0aGlzLnNhdmVWYWxpZGF0b3JzLmFkZEVudHJ5KCdkZWZhdWx0JywgdGhpcy5nZXRLZXkoJ3JhbmdlJywgJ2FsbCcpLCByYW5nZVZhbGlkYXRvcik7XG4gICAgICAgIHRoaXMuc2F2ZVZhbGlkYXRvcnMuYWRkRW50cnkoJ2RlZmF1bHQnLCB0aGlzLmdldEtleSgnY3VycmVuY3knLCAnYWxsJyksIGN1cnJlbmN5VmFsaWRhdG9yKTtcbiAgICAgICAgdGhpcy5zYXZlVmFsaWRhdG9ycy5hZGRFbnRyeSgnZGVmYXVsdCcsIHRoaXMuZ2V0S2V5KCdkYXRlJywgJ2FsbCcpLCBkYXRlVmFsaWRhdG9yKTtcbiAgICAgICAgdGhpcy5zYXZlVmFsaWRhdG9ycy5hZGRFbnRyeSgnZGVmYXVsdCcsIHRoaXMuZ2V0S2V5KCdkYXRldGltZScsICdhbGwnKSwgZGF0ZXRpbWVWYWxpZGF0b3IpO1xuICAgICAgICB0aGlzLnNhdmVWYWxpZGF0b3JzLmFkZEVudHJ5KCdkZWZhdWx0JywgdGhpcy5nZXRLZXkoJ2VtYWlsJywgJ2FsbCcpLCBlbWFpbFZhbGlkYXRvcik7XG4gICAgICAgIHRoaXMuc2F2ZVZhbGlkYXRvcnMuYWRkRW50cnkoJ2RlZmF1bHQnLCB0aGlzLmdldEtleSgnZmxvYXQnLCAnYWxsJyksIGZsb2F0VmFsaWRhdG9yKTtcbiAgICAgICAgdGhpcy5zYXZlVmFsaWRhdG9ycy5hZGRFbnRyeSgnZGVmYXVsdCcsIHRoaXMuZ2V0S2V5KCdpbnQnLCAnYWxsJyksIGludFZhbGlkYXRvcik7XG4gICAgICAgIHRoaXMuc2F2ZVZhbGlkYXRvcnMuYWRkRW50cnkoJ2RlZmF1bHQnLCB0aGlzLmdldEtleSgncGhvbmUnLCAnYWxsJyksIHBob25lVmFsaWRhdG9yKTtcbiAgICAgICAgdGhpcy5zYXZlVmFsaWRhdG9ycy5hZGRFbnRyeSgnZGVmYXVsdCcsIHRoaXMuZ2V0S2V5KCdwcmltYXJ5LWVtYWlsJywgJ2FsbCcpLCBwcmltYXJ5RW1haWxWYWxpZGF0b3IpO1xuICAgICAgICB0aGlzLnNhdmVWYWxpZGF0b3JzLmFkZEVudHJ5KCdkZWZhdWx0JywgdGhpcy5nZXRLZXkoJ2R1cGxpY2F0ZS1lbWFpbCcsICdhbGwnKSwgZHVwbGljYXRlRW1haWxWYWxpZGF0b3IpO1xuXG4gICAgICAgIHRoaXMuZmlsdGVyVmFsaWRhdG9ycy5hZGRFbnRyeSgnZGVmYXVsdCcsIHRoaXMuZ2V0S2V5KCdkYXRlJywgJ2FsbCcpLCBkYXRlVmFsaWRhdG9yKTtcbiAgICAgICAgdGhpcy5maWx0ZXJWYWxpZGF0b3JzLmFkZEVudHJ5KCdkZWZhdWx0JywgdGhpcy5nZXRLZXkoJ2RhdGV0aW1lJywgJ2FsbCcpLCBkYXRldGltZVZhbGlkYXRvcik7XG4gICAgICAgIHRoaXMuZmlsdGVyVmFsaWRhdG9ycy5hZGRFbnRyeSgnZGVmYXVsdCcsIHRoaXMuZ2V0S2V5KCdmbG9hdCcsICdhbGwnKSwgZmxvYXRWYWxpZGF0b3IpO1xuICAgICAgICB0aGlzLmZpbHRlclZhbGlkYXRvcnMuYWRkRW50cnkoJ2RlZmF1bHQnLCB0aGlzLmdldEtleSgnY3VycmVuY3knLCAnYWxsJyksIGN1cnJlbmN5VmFsaWRhdG9yKTtcbiAgICAgICAgdGhpcy5maWx0ZXJWYWxpZGF0b3JzLmFkZEVudHJ5KCdkZWZhdWx0JywgdGhpcy5nZXRLZXkoJ2ludCcsICdhbGwnKSwgaW50VmFsaWRhdG9yKTtcbiAgICAgICAgdGhpcy5maWx0ZXJWYWxpZGF0b3JzLmFkZEVudHJ5KCdkZWZhdWx0JywgdGhpcy5nZXRLZXkoJ3Bob25lJywgJ2FsbCcpLCBwaG9uZVZhbGlkYXRvcik7XG4gICAgfVxuXG4gICAgcHVibGljIHJlZ2lzdGVyRmllbGRTYXZlVmFsaWRhdG9yKG1vZHVsZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIHZhbGlkYXRvcjogVmFsaWRhdG9ySW50ZXJmYWNlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2F2ZVZhbGlkYXRvcnMuYWRkRW50cnkobW9kdWxlLCB0aGlzLmdldEtleSh0eXBlLCBmaWVsZCksIHZhbGlkYXRvcik7XG4gICAgfVxuXG4gICAgcHVibGljIHJlZ2lzdGVyU2F2ZVZhbGlkYXRvcihtb2R1bGU6IHN0cmluZywgdHlwZTogc3RyaW5nLCB2YWxpZGF0b3I6IFZhbGlkYXRvckludGVyZmFjZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNhdmVWYWxpZGF0b3JzLmFkZEVudHJ5KG1vZHVsZSwgdGhpcy5nZXRLZXkodHlwZSwgJ2FsbCcpLCB2YWxpZGF0b3IpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZWdpc3RlckZpZWxkRmlsdGVyVmFsaWRhdG9yKG1vZHVsZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIHZhbGlkYXRvcjogVmFsaWRhdG9ySW50ZXJmYWNlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZmlsdGVyVmFsaWRhdG9ycy5hZGRFbnRyeShtb2R1bGUsIHRoaXMuZ2V0S2V5KHR5cGUsIGZpZWxkKSwgdmFsaWRhdG9yKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVnaXN0ZXJGaWx0ZXJWYWxpZGF0b3IobW9kdWxlOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgdmFsaWRhdG9yOiBWYWxpZGF0b3JJbnRlcmZhY2UpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5maWx0ZXJWYWxpZGF0b3JzLmFkZEVudHJ5KG1vZHVsZSwgdGhpcy5nZXRLZXkodHlwZSwgJ2FsbCcpLCB2YWxpZGF0b3IpO1xuICAgIH1cblxuICAgIHB1YmxpYyBleGNsdWRlRmllbGRTYXZlVmFsaWRhdG9yKG1vZHVsZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcpOiB2b2lkIHtcblxuICAgICAgICBjb25zdCBtb2R1bGVFeGNsdXNpb25zID0gdGhpcy5zYXZlRmllbGRFeGNsdXNpb25zW21vZHVsZV0gfHwge307XG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KHR5cGUsIGZpZWxkKTtcbiAgICAgICAgbW9kdWxlRXhjbHVzaW9uc1trZXldID0ga2V5O1xuICAgICAgICB0aGlzLnNhdmVGaWVsZEV4Y2x1c2lvbnNbbW9kdWxlXSA9IG1vZHVsZUV4Y2x1c2lvbnM7XG4gICAgfVxuXG4gICAgcHVibGljIGV4Y2x1ZGVTYXZlVmFsaWRhdG9yKG1vZHVsZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zYXZlVmFsaWRhdG9ycy5leGNsdWRlRW50cnkobW9kdWxlLCB0aGlzLmdldEtleSh0eXBlLCAnYWxsJykpO1xuICAgIH1cblxuICAgIHB1YmxpYyBleGNsdWRlRmllbGRGaWx0ZXJWYWxpZGF0b3IobW9kdWxlOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgZmllbGQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBtb2R1bGVFeGNsdXNpb25zID0gdGhpcy5maWx0ZXJGaWVsZEV4Y2x1c2lvblttb2R1bGVdIHx8IHt9O1xuICAgICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleSh0eXBlLCBmaWVsZCk7XG4gICAgICAgIG1vZHVsZUV4Y2x1c2lvbnNba2V5XSA9IGtleTtcbiAgICAgICAgdGhpcy5maWx0ZXJGaWVsZEV4Y2x1c2lvblttb2R1bGVdID0gbW9kdWxlRXhjbHVzaW9ucztcbiAgICB9XG5cbiAgICBwdWJsaWMgZXhjbHVkZUZpbHRlclZhbGlkYXRvcihtb2R1bGU6IHN0cmluZywgdHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZmlsdGVyVmFsaWRhdG9ycy5leGNsdWRlRW50cnkobW9kdWxlLCB0aGlzLmdldEtleSh0eXBlLCAnYWxsJykpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZWdpc3RlckFzeW5jU2F2ZVZhbGlkYXRvcihtb2R1bGU6IHN0cmluZywgdHlwZTogc3RyaW5nLCB2YWxpZGF0b3I6IEFzeW5jVmFsaWRhdG9ySW50ZXJmYWNlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYXN5bmNTYXZlVmFsaWRhdG9ycy5hZGRFbnRyeShtb2R1bGUsIHRoaXMuZ2V0S2V5KHR5cGUsICdhbGwnKSwgdmFsaWRhdG9yKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZXhjbHVkZUFzeW5jU2F2ZVZhbGlkYXRvcihtb2R1bGU6IHN0cmluZywgdHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2F2ZVZhbGlkYXRvcnMuZXhjbHVkZUVudHJ5KG1vZHVsZSwgdGhpcy5nZXRLZXkodHlwZSwgJ2FsbCcpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U2F2ZVZhbGlkYXRpb25zKG1vZHVsZTogc3RyaW5nLCB2aWV3RmllbGQ6IFZpZXdGaWVsZERlZmluaXRpb24sIHJlY29yZDogUmVjb3JkKTogVmFsaWRhdG9yRm5bXSB7XG4gICAgICAgIGNvbnN0IGVudHJpZXMgPSB0aGlzLnNhdmVWYWxpZGF0b3JzLmdldEdyb3VwRW50cmllcyhtb2R1bGUpO1xuICAgICAgICBjb25zdCBleGNsdXNpb25zID0gdGhpcy5nZXRFeGNsdXNpb25zKG1vZHVsZSwgdGhpcy5zYXZlRmllbGRFeGNsdXNpb25zKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyVmFsaWRhdGlvbnMoZW50cmllcywgZXhjbHVzaW9ucywgcmVjb3JkLCB2aWV3RmllbGQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRGaWx0ZXJWYWxpZGF0aW9ucyhtb2R1bGU6IHN0cmluZywgdmlld0ZpZWxkOiBWaWV3RmllbGREZWZpbml0aW9uLCByZWNvcmQ6IFJlY29yZCk6IFZhbGlkYXRvckZuW10ge1xuICAgICAgICBjb25zdCBlbnRyaWVzID0gdGhpcy5maWx0ZXJWYWxpZGF0b3JzLmdldEdyb3VwRW50cmllcyhtb2R1bGUpO1xuICAgICAgICBjb25zdCBleGNsdXNpb25zID0gdGhpcy5nZXRFeGNsdXNpb25zKG1vZHVsZSwgdGhpcy5maWx0ZXJGaWVsZEV4Y2x1c2lvbik7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlclZhbGlkYXRpb25zKGVudHJpZXMsIGV4Y2x1c2lvbnMsIHJlY29yZCwgdmlld0ZpZWxkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QXN5bmNTYXZlVmFsaWRhdGlvbnMobW9kdWxlOiBzdHJpbmcsIHZpZXdGaWVsZDogVmlld0ZpZWxkRGVmaW5pdGlvbiwgcmVjb3JkOiBSZWNvcmQpOiBBc3luY1ZhbGlkYXRvckZuW10ge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgICAgIGNvbnN0IGVudHJpZXMgPSB0aGlzLmFzeW5jU2F2ZVZhbGlkYXRvcnMuZ2V0R3JvdXBFbnRyaWVzKG1vZHVsZSk7XG5cbiAgICAgICAgT2JqZWN0LmtleXMoZW50cmllcykuZm9yRWFjaCh2YWxpZGF0b3JLZXkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0b3IgPSBlbnRyaWVzW3ZhbGlkYXRvcktleV07XG5cbiAgICAgICAgICAgIGlmICh2YWxpZGF0b3IuYXBwbGllcyhyZWNvcmQsIHZpZXdGaWVsZCkpIHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9ucy5wdXNoKHZhbGlkYXRvci5nZXRWYWxpZGF0b3Iodmlld0ZpZWxkLCByZWNvcmQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25zO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRLZXkodHlwZTogc3RyaW5nLCBmaWVsZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGAke3R5cGV9LiR7ZmllbGR9YDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgcGFyc2VUeXBlKGtleTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgcGFydHNUeXBlID0ga2V5LnNwbGl0KCcuJykgfHwgW107XG4gICAgICAgIHJldHVybiBwYXJ0c1R5cGVbMF0gfHwgJyc7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldEV4Y2x1c2lvbnMobW9kdWxlOiBzdHJpbmcsIGV4Y2x1c2lvbk1hcDogU3RyaW5nTWF0cml4KTogU3RyaW5nTWFwIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdEV4Y2x1c2lvbnMgPSBleGNsdXNpb25NYXBbJ2RlZmF1bHQnXSB8fCB7fTtcbiAgICAgICAgY29uc3QgbW9kdWxlRXhjbHVzaW9ucyA9IGV4Y2x1c2lvbk1hcFttb2R1bGVdIHx8IHt9O1xuICAgICAgICByZXR1cm4gey4uLmRlZmF1bHRFeGNsdXNpb25zLCAuLi5tb2R1bGVFeGNsdXNpb25zfTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZmlsdGVyVmFsaWRhdGlvbnMoXG4gICAgICAgIGVudHJpZXM6IE1hcEVudHJ5PFZhbGlkYXRvckludGVyZmFjZT4sXG4gICAgICAgIGZpZWxkRXhjbHVzaW9uczogU3RyaW5nTWFwLFxuICAgICAgICByZWNvcmQ6IFJlY29yZCxcbiAgICAgICAgdmlld0ZpZWxkOiBWaWV3RmllbGREZWZpbml0aW9uXG4gICAgKTogVmFsaWRhdG9yRm5bXSB7XG4gICAgICAgIGxldCB2YWxpZGF0aW9ucyA9IFtdO1xuXG4gICAgICAgIE9iamVjdC5rZXlzKGVudHJpZXMpLmZvckVhY2godmFsaWRhdG9yS2V5ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRUeXBlS2V5ID0gdGhpcy5nZXRLZXkodGhpcy5wYXJzZVR5cGUodmFsaWRhdG9yS2V5KSwgdmlld0ZpZWxkLm5hbWUpO1xuICAgICAgICAgICAgaWYgKGZpZWxkRXhjbHVzaW9uc1t2YWxpZGF0b3JLZXldIHx8IGZpZWxkRXhjbHVzaW9uc1tkZWZhdWx0VHlwZUtleV0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRvciA9IGVudHJpZXNbdmFsaWRhdG9yS2V5XTtcblxuICAgICAgICAgICAgaWYgKHZhbGlkYXRvci5hcHBsaWVzKHJlY29yZCwgdmlld0ZpZWxkKSkge1xuICAgICAgICAgICAgICAgIHZhbGlkYXRpb25zID0gdmFsaWRhdGlvbnMuY29uY2F0KHZhbGlkYXRvci5nZXRWYWxpZGF0b3Iodmlld0ZpZWxkLCByZWNvcmQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25zO1xuICAgIH1cbn1cbiJdfQ==